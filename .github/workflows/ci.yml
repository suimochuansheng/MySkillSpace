name: CIä»£ç æ£€æŸ¥

on:
  push:
    branches: [ "main", "master", "dev" ]
  pull_request:
    branches: [ "main", "master" ]

permissions:
  contents: read

jobs:
  lint:
    name: ä»£ç è§„èŒƒæ£€æŸ¥ä»»åŠ¡
    runs-on: ubuntu-latest
    
    steps:
    # æ­¥éª¤1ï¼šæ£€å‡ºä»“åº“ä»£ç 
    - name: ğŸ™ æ­¥éª¤1ï¼šæ£€å‡ºä»“åº“ä»£ç 
      id: checkout
      uses: actions/checkout@v4
      # GitHub Action è‡ªå¸¦æ­¥éª¤çŠ¶æ€æ£€æŸ¥ï¼Œå¦‚æœå¤±è´¥ä¼šç›´æ¥åœæ­¢
    
    # æ­¥éª¤2ï¼šé…ç½®Pythonè¿è¡Œç¯å¢ƒ
    - name: âš™ï¸ æ­¥éª¤2ï¼šé…ç½® Python 3.11 ç¯å¢ƒ
      id: setup-python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    # æ­¥éª¤3ï¼šå®‰è£…ä»£ç æ£€æŸ¥å·¥å…·
    - name: ğŸ“¦ æ­¥éª¤3ï¼šå®‰è£…æ£€æŸ¥å·¥å…· (flake8, isort, black, pre-commit)
      id: install-tools
      run: |
        echo "æ­£åœ¨å®‰è£…å·¥å…·åŒ…..."
        if pip install flake8 isort black pre-commit; then
          echo "=========================================="
          echo "âœ… æˆåŠŸï¼šæ£€æŸ¥å·¥å…·å·²å®‰è£…å®Œæ¯•ï¼"
          echo "=========================================="
        else
          echo "=========================================="
          echo "âŒ å¤±è´¥ï¼šå·¥å…·å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç‰ˆæœ¬ï¼"
          echo "=========================================="
          exit 1
        fi
    
    # æ­¥éª¤4ï¼šè¿è¡Œä»£ç æ£€æŸ¥
    - name: ğŸ” æ­¥éª¤4ï¼šæ‰§è¡Œä»£ç è§„èŒƒæ£€æŸ¥
      id: run-check
      run: |
        echo "å¼€å§‹æ‰«æé¡¹ç›®ä»£ç ..."
        echo "------------------------------------------"
        if pre-commit run --all-files; then
          echo "------------------------------------------"
          echo "ğŸ‰ å®Œç¾ï¼"
          echo "âœ… [SUCCESS] ä»£ç æ ¼å¼å’Œè§„èŒƒæ£€æŸ¥å…¨éƒ¨é€šè¿‡ï¼"
          echo "âœ¨ ä½ çš„ä»£ç éå¸¸ä¼˜é›…ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œåˆå¹¶ã€‚"
          echo "------------------------------------------"
        else
          echo "------------------------------------------"
          echo "ğŸš© æ³¨æ„ï¼"
          echo "âŒ [FAILED] å‘ç°ä»£ç è§„èŒƒé—®é¢˜ï¼"
          echo "ğŸ’¡ è¯·æŸ¥çœ‹ä¸Šæ–¹æ—¥å¿—ï¼Œåœ¨æœ¬åœ°ä¿®å¤åå†æäº¤ã€‚"
          echo "------------------------------------------"
          exit 1
        fi
    
    # æ­¥éª¤5ï¼šæ€»ç»“ï¼ˆå¯é€‰ï¼‰
    - name: ğŸ“Š ä»»åŠ¡çŠ¶æ€æ±‡æŠ¥
      if: always() # æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šæ‰§è¡Œè¿™ä¸€æ­¥
      run: |
        if [[ "${{ job.status }}" == "success" ]]; then
          echo "ğŸš€ æœ€ç»ˆç»“æœï¼šCI æµç¨‹åœ†æ»¡å®Œæˆï¼"
        else
          echo "ğŸš¨ æœ€ç»ˆç»“æœï¼šCI æµç¨‹ä¸­é€”ç”±äºè§„èŒƒé—®é¢˜è¢«æ‹¦æˆªã€‚"
        fi