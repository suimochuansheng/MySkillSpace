name: CIä»£ç æ£€æŸ¥

on:
  push:
    branches: [ "main", "master", "dev" ]
  pull_request:
    branches: [ "main", "master" ]

permissions:
  contents: read

jobs:
  lint:
    name: ä»£ç è§„èŒƒæ£€æŸ¥
    runs-on: ubuntu-latest
    
    steps:
    # 1. ä¸‹è½½ä»£ç 
    - name: ğŸ™ æ£€å‡ºä»“åº“ä»£ç 
      uses: actions/checkout@v4

    # 2. å‡†å¤‡ Python 3.11 ç¯å¢ƒ
    - name: âš™ï¸ é…ç½® Python ç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    # 3. ç¼“å­˜ï¼ˆå¤§å¹…æå‡åç»­è¿è¡Œé€Ÿåº¦ï¼‰
    - name: ğŸ’¾ ç¼“å­˜ pre-commit ä¾èµ–
      uses: actions/cache@v4
      with:
        path: ~/.cache/pre-commit
        key: ${{ runner.os }}-pre-commit-${{ hashFiles('.pre-commit-config.yaml') }}

    # 4. å®‰è£… pre-commit æ ¸å¿ƒå·¥å…·
    - name: ğŸ“¦ å®‰è£… pre-commit
      run: pip install pre-commit

    # 5. æ‰§è¡Œæ£€æŸ¥ï¼ˆæ ¸å¿ƒï¼šè¯»å–ä½ çš„ .pre-commit-config.yamlï¼‰
    - name: ğŸ” è¿è¡Œä»£ç æ£€æŸ¥ (Black, isort, Flake8)
      run: |
        if pre-commit run --all-files; then
          echo "âœ… æ­å–œï¼ä»£ç æ ¼å¼å®Œç¾ï¼Œæ£€æŸ¥é€šè¿‡ã€‚"
        else
          echo "âŒ æ£€æŸ¥å¤±è´¥ï¼è¯·æ ¹æ®ä¸Šæ–¹æŠ¥é”™ä¿®æ”¹ä»£ç æ ¼å¼ã€‚"
          exit 1
        fi