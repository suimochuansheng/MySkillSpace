# ========================================
# SkillSpace é¡¹ç›®æŒç»­é›†æˆå·¥ä½œæµé…ç½®
# CI/CD Pipeline for SkillSpace Project
# ========================================
# æŠ€æœ¯æ ˆï¼š
#   å‰ç«¯ï¼šVue 3.5.24 + Element Plus 2.11.9 + Vite 7.2.4
#   åŽç«¯ï¼šDjango 5.2.8 + Django REST Framework 3.16.1
#   æ•°æ®åº“ï¼šMySQLï¼ˆç”Ÿäº§ï¼‰/ SQLiteï¼ˆæµ‹è¯•ï¼‰
#   ä»»åŠ¡é˜Ÿåˆ—ï¼šCelery 5.5.3 + Redis
# ========================================

name: SkillSpace CI/CD Pipeline

# ========================================
# å·¥ä½œæµè§¦å‘æ¡ä»¶
# ========================================
on:
  # å½“ä»£ç æŽ¨é€åˆ°mainæˆ–developåˆ†æ”¯æ—¶è§¦å‘
  push:
    branches:
      - main
      - develop
  
  # å½“åˆ›å»ºé’ˆå¯¹mainæˆ–developåˆ†æ”¯çš„Pull Requestæ—¶è§¦å‘
  pull_request:
    branches:
      - main
      - develop
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµï¼ˆç”¨äºŽæµ‹è¯•æˆ–ç´§æ€¥éƒ¨ç½²ï¼‰
  workflow_dispatch:

# ========================================
# çŽ¯å¢ƒå˜é‡ï¼ˆå…¨å±€ï¼‰
# ========================================
env:
  # Pythonç‰ˆæœ¬ï¼ˆé€‚é…Qwen-7B-Chatå¤§è¯­è¨€æ¨¡åž‹éƒ¨ç½²éœ€æ±‚ï¼‰
  PYTHON_VERSION: '3.9'
  
  # Node.jsç‰ˆæœ¬ï¼ˆä½¿ç”¨LTSç‰ˆæœ¬ï¼Œpackage.jsonæœªæŒ‡å®šenginesï¼‰
  NODE_VERSION: '20'
  
  # å‰ç«¯æž„å»ºè¾“å‡ºç›®å½•
  FRONTEND_BUILD_DIR: frontend/skillspace/dist
  
  # åŽç«¯å·¥ä½œç›®å½•
  BACKEND_DIR: backend

# ========================================
# ä½œä¸šå®šä¹‰ï¼ˆJobsï¼‰
# ========================================
jobs:
  # ========================================
  # ä½œä¸š1ï¼šå‰ç«¯æµ‹è¯•å’Œæž„å»º
  # ========================================
  frontend-test-build:
    name: å‰ç«¯æµ‹è¯•ä¸Žæž„å»º (Vue 3 + Vite)
    runs-on: ubuntu-latest
    
    # å·¥ä½œç›®å½•è®¾ç½®ä¸ºå‰ç«¯é¡¹ç›®ç›®å½•
    defaults:
      run:
        working-directory: frontend/skillspace
    
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç ä»“åº“
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      # æ­¥éª¤2ï¼šè®¾ç½®Node.jsçŽ¯å¢ƒ
      - name: ðŸŸ¢ è®¾ç½® Node.js ${{ env.NODE_VERSION }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          # å¯ç”¨npmç¼“å­˜ï¼ŒåŠ é€Ÿä¾èµ–å®‰è£…
          cache: 'npm'
          cache-dependency-path: frontend/skillspace/package-lock.json
      
      # æ­¥éª¤3ï¼šå®‰è£…å‰ç«¯ä¾èµ–
      - name: ðŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–
        run: |
          echo "å¼€å§‹å®‰è£…Vueã€Element Plusç­‰å‰ç«¯ä¾èµ–..."
          npm ci --prefer-offline --no-audit
          echo "âœ… å‰ç«¯ä¾èµ–å®‰è£…å®Œæˆ"
      
      # æ­¥éª¤4ï¼šè¿è¡Œå‰ç«¯ä»£ç æ£€æŸ¥ï¼ˆå¦‚æžœæœ‰é…ç½®ESLintï¼‰
      # - name: ðŸ” ä»£ç è´¨é‡æ£€æŸ¥ (ESLint)
      #   run: npm run lint
      #   continue-on-error: true  # å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­æ‰§è¡Œ
      
      # æ­¥éª¤5ï¼šè¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•ï¼ˆå¦‚æžœæœ‰é…ç½®Vitest/Jestï¼‰
      # - name: ðŸ§ª è¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•
      #   run: npm run test:unit
      #   env:
      #     NODE_ENV: test
      
      # æ­¥éª¤6ï¼šæž„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬
      - name: ðŸ—ï¸ æž„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬
        run: |
          echo "å¼€å§‹æž„å»ºViteç”Ÿäº§ç‰ˆæœ¬..."
          npm run build
          echo "âœ… å‰ç«¯æž„å»ºå®Œæˆï¼Œè¾“å‡ºç›®å½•: dist/"
      
      # æ­¥éª¤7ï¼šä¸Šä¼ æž„å»ºäº§ç‰©ï¼ˆç”¨äºŽåŽç»­éƒ¨ç½²ï¼‰
      - name: ðŸ“¤ ä¸Šä¼ å‰ç«¯æž„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: frontend-dist
          path: ${{ env.FRONTEND_BUILD_DIR }}
          retention-days: 7  # ä¿å­˜7å¤©
          if-no-files-found: error

  # ========================================
  # ä½œä¸š2ï¼šåŽç«¯æµ‹è¯•å’Œæ£€æŸ¥
  # ========================================
  backend-test:
    name: åŽç«¯æµ‹è¯•ä¸Žæ£€æŸ¥ (Django + DRF)
    runs-on: ubuntu-latest
    
    # å·¥ä½œç›®å½•è®¾ç½®ä¸ºåŽç«¯é¡¹ç›®ç›®å½•
    defaults:
      run:
        working-directory: backend
    
    # æœåŠ¡å®¹å™¨é…ç½®ï¼ˆç”¨äºŽæµ‹è¯•çŽ¯å¢ƒï¼‰
    services:
      # RedisæœåŠ¡ï¼ˆCeleryä»»åŠ¡é˜Ÿåˆ—ä¾èµ–ï¼‰
      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç ä»“åº“
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      # æ­¥éª¤2ï¼šè®¾ç½®PythonçŽ¯å¢ƒ
      - name: ðŸ è®¾ç½® Python ${{ env.PYTHON_VERSION }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          # å¯ç”¨pipç¼“å­˜ï¼ŒåŠ é€Ÿä¾èµ–å®‰è£…
          cache: 'pip'
          cache-dependency-path: backend/requirements.txt
      
# æ­¥éª¤3ï¼šå®‰è£…Pythonä¾èµ–
      - name: ðŸ“¦ å®‰è£…åŽç«¯ä¾èµ–
        run: |
          echo "å‡çº§pipåˆ°æœ€æ–°ç‰ˆæœ¬..."
          python -m pip install --upgrade pip
          
          echo "ðŸ”§ æ­£åœ¨é€‚é… CI çŽ¯å¢ƒ..."
          
          # =======================================================
          # ä¿®æ”¹æ–¹æ¡ˆï¼šä½¿ç”¨ grep ç”Ÿæˆå¹²å‡€çš„ä¾èµ–æ–‡ä»¶
          # åŽŸå› ï¼šåŽŸ requirements.txt åŒ…å« PyPI ä¸Šæ²¡æœ‰çš„ +cu124 ç‰ˆæœ¬
          # =======================================================
          
          # 1. è¿‡æ»¤æŽ‰æ‰€æœ‰åŒ…å« 'torch' å­—çœ¼çš„è¡Œï¼Œç”Ÿæˆ requirements.ci.txt
          # è¿™ä¼šè‡ªåŠ¨å‰”é™¤ torch, torchvision, torchaudio
          grep -v "torch" requirements.txt > requirements.ci.txt
          
          echo "ðŸ“‹ æ£€æŸ¥ç”Ÿæˆçš„ CI ä¾èµ–æ–‡ä»¶ (å‰10è¡Œ):"
          head -n 10 requirements.ci.txt
          
          # 2. ã€å…³é”®ã€‘æ‰‹åŠ¨å®‰è£… CPU ç‰ˆæœ¬çš„ PyTorch
          # å¿…é¡»æŒ‡å®š --index-url https://download.pytorch.org/whl/cpu
          # è¿™æ ·æ—¢å¿«åˆä¸ä¼šæŠ¥é”™ï¼Œä¸”æ»¡è¶³ Django è¿è¡Œéœ€æ±‚
          echo "â¬‡ï¸ å®‰è£… PyTorch (CPUç‰ˆ)..."
          pip install torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 --index-url https://download.pytorch.org/whl/cpu
          
          # 3. å®‰è£…å‰©ä½™çš„å…¶ä»–ä¾èµ–
          # æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨æˆ‘ä»¬æ–°ç”Ÿæˆçš„ requirements.ci.txt
          echo "â¬‡ï¸ å®‰è£…å…¶ä»–ä¾èµ–..."
          pip install -r requirements.ci.txt
          
          echo "âœ… åŽç«¯ä¾èµ–å®‰è£…å®Œæˆ"
          echo "å·²å®‰è£…çš„åŒ…åˆ—è¡¨ï¼š"
          pip list
      
      # æ­¥éª¤4ï¼šé…ç½®æµ‹è¯•çŽ¯å¢ƒå˜é‡
      - name: âš™ï¸ é…ç½®æµ‹è¯•çŽ¯å¢ƒå˜é‡
        run: |
          # åˆ›å»ºæµ‹è¯•ç”¨çš„.envæ–‡ä»¶
          cat > .env << EOF
          # Djangoæ ¸å¿ƒé…ç½®
          SECRET_KEY=test-secret-key-for-ci-only-do-not-use-in-production
          DEBUG=False
          
          # æ•°æ®åº“é…ç½®ï¼ˆä½¿ç”¨SQLiteè¿›è¡Œæµ‹è¯•ï¼‰
          DB_ENGINE=django.db.backends.sqlite3
          DB_NAME=:memory:
          
          # Celeryé…ç½®ï¼ˆä½¿ç”¨CIçŽ¯å¢ƒçš„Redisï¼‰
          CELERY_BROKER_URL=redis://localhost:6379/0
          CELERY_RESULT_BACKEND=redis://localhost:6379/0
          EOF
          
          echo "âœ… æµ‹è¯•çŽ¯å¢ƒå˜é‡é…ç½®å®Œæˆ"
      
      # æ­¥éª¤5ï¼šè¿è¡ŒDjangoç³»ç»Ÿæ£€æŸ¥
      - name: ðŸ” Djangoç³»ç»Ÿæ£€æŸ¥
        run: |
          echo "è¿è¡ŒDjangoé…ç½®æ£€æŸ¥..."
          python manage.py check --settings=SkillSpace.settings_test
          echo "âœ… ç³»ç»Ÿæ£€æŸ¥é€šè¿‡"
      
      # æ­¥éª¤6ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼ˆæµ‹è¯•çŽ¯å¢ƒï¼‰
      - name: ðŸ—„ï¸ æ‰§è¡Œæ•°æ®åº“è¿ç§»
        run: |
          echo "åˆ›å»ºæµ‹è¯•æ•°æ®åº“å¹¶æ‰§è¡Œè¿ç§»..."
          python manage.py migrate --settings=SkillSpace.settings_test --noinput
          echo "âœ… æ•°æ®åº“è¿ç§»å®Œæˆ"
      
      # æ­¥éª¤7ï¼šè¿è¡ŒDjangoå•å…ƒæµ‹è¯•
      - name: ðŸ§ª è¿è¡ŒåŽç«¯å•å…ƒæµ‹è¯•
        run: |
          echo "å¼€å§‹è¿è¡ŒDjangoæµ‹è¯•å¥—ä»¶..."
          python manage.py test --settings=SkillSpace.settings_test --verbosity=2 --keepdb
          echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"
        env:
          DJANGO_SETTINGS_MODULE: SkillSpace.settings_test
      
      # æ­¥éª¤8ï¼šä»£ç è´¨é‡æ£€æŸ¥ï¼ˆå¯é€‰ï¼šflake8/black/pylintï¼‰
      # - name: ðŸ” ä»£ç è´¨é‡æ£€æŸ¥ (flake8)
      #   run: |
      #     pip install flake8
      #     flake8 SkillSpace --max-line-length=120 --exclude=migrations,__pycache__
      #   continue-on-error: true
      
      # æ­¥éª¤9ï¼šå®‰å…¨æ£€æŸ¥ï¼ˆå¯é€‰ï¼šbandit/safetyï¼‰
      # - name: ðŸ”’ å®‰å…¨æ¼æ´žæ‰«æ
      #   run: |
      #     pip install safety bandit
      #     safety check --json
      #     bandit -r SkillSpace -ll
      #   continue-on-error: true

  # ========================================
  # ä½œä¸š3ï¼šä»£ç è´¨é‡æ£€æŸ¥ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
  # ========================================
  code-quality:
    name: ä»£ç è´¨é‡æ£€æŸ¥
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      # æ­¥éª¤ï¼šæ£€æŸ¥ä»£ç é£Žæ ¼å’Œæ½œåœ¨é—®é¢˜
      - name: ðŸ” è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥
        run: |
          echo "ä»£ç è´¨é‡æ£€æŸ¥å ä½ç¬¦"
          echo "å¯é›†æˆï¼šESLintã€Prettierã€Flake8ã€Blackç­‰å·¥å…·"
          echo "âœ… è´¨é‡æ£€æŸ¥å®Œæˆ"

  # ========================================
  # ä½œä¸š4ï¼šæž„å»ºæˆåŠŸé€šçŸ¥
  # ========================================
  build-success:
    name: âœ… æž„å»ºæˆåŠŸ
    runs-on: ubuntu-latest
    # ç­‰å¾…æ‰€æœ‰å‰ç½®ä½œä¸šæˆåŠŸå®Œæˆ
    needs: [frontend-test-build, backend-test, code-quality]
    
    steps:
      - name: ðŸŽ‰ æž„å»ºæˆåŠŸé€šçŸ¥
        run: |
          echo "========================================"
          echo "âœ… SkillSpace CI Pipeline æž„å»ºæˆåŠŸï¼"
          echo "========================================"
          echo "å‰ç«¯æž„å»ºï¼šâœ… é€šè¿‡"
          echo "åŽç«¯æµ‹è¯•ï¼šâœ… é€šè¿‡"
          echo "ä»£ç è´¨é‡ï¼šâœ… é€šè¿‡"
          echo "========================================"
          echo "ðŸ“¦ å‰ç«¯æž„å»ºäº§ç‰©å·²ä¸Šä¼ ï¼Œå¯ç”¨äºŽéƒ¨ç½²"
          echo "ðŸš€ å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¿›è¡ŒCDéƒ¨ç½²"
          echo "========================================"

# ========================================
# CDæŒç»­éƒ¨ç½²æž¶æž„å»ºè®®ï¼ˆä»…ä¾›å‚è€ƒï¼‰
# ========================================
# 
# ä¸€ã€éƒ¨ç½²ç›®æ ‡çŽ¯å¢ƒé€‰é¡¹
# ========================================
# 
# 1. äº‘æœåŠ¡å™¨éƒ¨ç½²ï¼ˆæŽ¨èï¼‰
#    - é€‚ç”¨åœºæ™¯ï¼šç”Ÿäº§çŽ¯å¢ƒã€å®Œæ•´æŽ§åˆ¶æƒ
#    - æŽ¨èæœåŠ¡å•†ï¼š
#      * é˜¿é‡Œäº‘ ECS
#      * è…¾è®¯äº‘ CVM
#      * AWS EC2
#      * DigitalOcean Droplet
#    - éƒ¨ç½²æ–¹æ¡ˆï¼š
#      å‰ç«¯: Nginx æ‰˜ç®¡é™æ€æ–‡ä»¶ (dist/)
#      åŽç«¯: Gunicorn + Nginx åå‘ä»£ç†
#      æ•°æ®åº“: MySQL 8.0
#      ç¼“å­˜: Redis 7.x
#      ä»»åŠ¡é˜Ÿåˆ—: Celery + Redis
# 
# 2. å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker + Kubernetesï¼‰
#    - é€‚ç”¨åœºæ™¯ï¼šå¾®æœåŠ¡æž¶æž„ã€é«˜å¯ç”¨æ€§
#    - æŠ€æœ¯æ ˆï¼š
#      Docker Compose (å¼€å‘/æµ‹è¯•)
#      Kubernetes (ç”Ÿäº§)
#    - å®¹å™¨åŒ–ç»„ä»¶ï¼š
#      - frontend: nginx:alpine + é™æ€æ–‡ä»¶
#      - backend: python:3.12-slim + Django
#      - database: mysql:8.0
#      - redis: redis:7-alpine
#      - celery-worker: ä¸Ž backend ç›¸åŒé•œåƒ
# 
# 3. é™æ€æ‰˜ç®¡æœåŠ¡ï¼ˆä»…å‰ç«¯ï¼‰
#    - é€‚ç”¨åœºæ™¯ï¼šå‰åŽç«¯åˆ†ç¦»ã€å‰ç«¯ç‹¬ç«‹éƒ¨ç½²
#    - æœåŠ¡å•†ï¼š
#      * Vercel (æŽ¨èã€å…è´¹é¢åº¦)
#      * Netlify
#      * Cloudflare Pages
#      * é˜¿é‡Œäº‘ OSS + CDN
#    - åŽç«¯ç‹¬ç«‹éƒ¨ç½²è‡³äº‘æœåŠ¡å™¨
# 
# 4. PaaS å¹³å°éƒ¨ç½²
#    - é€‚ç”¨åœºæ™¯ï¼šå¿«é€Ÿä¸Šçº¿ã€æ— éœ€è¿ç»´
#    - å¹³å°é€‰æ‹©ï¼š
#      * Heroku
#      * Railway
#      * Render
#      * é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— FC
# 
# ========================================
# äºŒã€çŽ¯å¢ƒå˜é‡å’Œå¯†é’¥ç®¡ç†æ–¹æ¡ˆ
# ========================================
# 
# 1. GitHub Secrets é…ç½®ï¼ˆå¿…é¡»ï¼‰
#    åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ Secretsï¼š
#    
#    åŽç«¯çŽ¯å¢ƒå˜é‡ï¼š
#    - SECRET_KEY: Djangoå¯†é’¥ (50å­—ç¬¦éšæœºå­—ç¬¦ä¸²)
#    - DB_HOST: ç”Ÿäº§æ•°æ®åº“åœ°å€
#    - DB_NAME: æ•°æ®åº“å
#    - DB_USER: æ•°æ®åº“ç”¨æˆ·å
#    - DB_PASSWORD: æ•°æ®åº“å¯†ç 
#    - CELERY_BROKER_URL: Redisåœ°å€
#    
#    éƒ¨ç½²å‡­è¯ï¼š
#    - SSH_PRIVATE_KEY: æœåŠ¡å™¨SSHç§é’¥
#    - SERVER_HOST: æœåŠ¡å™¨IPæˆ–åŸŸå
#    - SERVER_USER: SSHç”¨æˆ·å
#    - DOCKER_USERNAME: Docker Hubç”¨æˆ·å
#    - DOCKER_PASSWORD: Docker Hubå¯†ç 
# 
# 2. .env æ–‡ä»¶ç®¡ç†
#    - å¼€å‘çŽ¯å¢ƒ: .env.development
#    - æµ‹è¯•çŽ¯å¢ƒ: .env.test (CI/CDè‡ªåŠ¨ç”Ÿæˆ)
#    - ç”Ÿäº§çŽ¯å¢ƒ: .env.production (æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨é…ç½®)
#    - æ³¨æ„: .env* å·²åŠ å…¥ .gitignoreï¼Œä¸æäº¤è‡³Git
# 
# 3. å¯†é’¥è½®æ¢ç­–ç•¥
#    - SECRET_KEY: æ¯å­£åº¦æ›´æ–°
#    - DB_PASSWORD: æ¯6ä¸ªæœˆæ›´æ–°
#    - APIå¯†é’¥: æ¯æœˆæ£€æŸ¥ï¼Œå¯ç–‘æ—¶ç«‹å³æ›´æ¢
# 
# ========================================
# ä¸‰ã€éƒ¨ç½²ç­–ç•¥é€‰æ‹©
# ========================================
# 
# 1. è“ç»¿éƒ¨ç½²ï¼ˆBlue-Green Deploymentï¼‰
#    - åŽŸç†ï¼šåŒæ—¶è¿è¡Œä¸¤å¥—ç›¸åŒçŽ¯å¢ƒï¼ˆè“ç»¿ï¼‰ï¼Œåˆ‡æ¢æµé‡
#    - ä¼˜ç‚¹ï¼šé›¶åœæœºã€å¿«é€Ÿå›žæ»š
#    - ç¼ºç‚¹ï¼šéœ€è¦åŒå€èµ„æº
#    - å®žçŽ°ï¼š
#      * Kubernetesï¼šä½¿ç”¨ Service åˆ‡æ¢
#      * Nginxï¼šä¿®æ”¹ upstream é…ç½®
# 
# 2. æ»šåŠ¨æ›´æ–°ï¼ˆRolling Updateï¼‰
#    - åŽŸç†ï¼šé€æ­¥æ›´æ–°å®žä¾‹ï¼Œä¿æŒéƒ¨åˆ†æœåŠ¡å¯ç”¨
#    - ä¼˜ç‚¹ï¼šèŠ‚çœèµ„æºã€æ¸è¿›å¼éƒ¨ç½²
#    - ç¼ºç‚¹ï¼šéƒ¨ç½²è¿‡ç¨‹ä¸­ç‰ˆæœ¬æ··åˆ
#    - å®žçŽ°ï¼š
#      * Kubernetesï¼šé»˜è®¤ç­–ç•¥
#      * Docker Swarmï¼šè‡ªåŠ¨æ»šåŠ¨
# 
# 3. é‡‘ä¸é›€éƒ¨ç½²ï¼ˆCanary Deploymentï¼‰
#    - åŽŸç†ï¼šå…ˆå°†æ–°ç‰ˆæœ¬éƒ¨ç½²è‡³å°‘é‡ç”¨æˆ·ï¼ŒéªŒè¯åŽå…¨é‡ä¸Šçº¿
#    - ä¼˜ç‚¹ï¼šé£Žé™©å¯æŽ§ã€åŠæ—©å‘çŽ°é—®é¢˜
#    - ç¼ºç‚¹ï¼šå®žçŽ°å¤æ‚ã€éœ€è¦æµé‡æŽ§åˆ¶
#    - å®žçŽ°ï¼š
#      * Istio Service Mesh
#      * Nginx æƒé‡è·¯ç”±
# 
# ========================================
# å››ã€CDå·¥ä½œæµç¤ºä¾‹ï¼ˆäº‘æœåŠ¡å™¨éƒ¨ç½²ï¼‰
# ========================================
# 
# æ·»åŠ ä»¥ä¸‹ä½œä¸šåˆ° ci.yml æˆ–åˆ›å»ºå•ç‹¬çš„ cd.ymlï¼š
# 
#  deploy-production:
#    name: ðŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒ
#    runs-on: ubuntu-latest
#    needs: build-success
#    # ä»…åœ¨mainåˆ†æ”¯æŽ¨é€æ—¶æ‰§è¡Œ
#    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
#    
#    steps:
#      - name: ðŸ“¥ æ£€å‡ºä»£ç 
#        uses: actions/checkout@v4
#      
#      # ä¸‹è½½å‰ç«¯æž„å»ºäº§ç‰©
#      - name: ðŸ“¥ ä¸‹è½½å‰ç«¯æž„å»ºäº§ç‰©
#        uses: actions/download-artifact@v4
#        with:
#          name: frontend-dist
#          path: ./dist
#      
#      # éƒ¨ç½²å‰ç«¯åˆ°NginxæœåŠ¡å™¨
#      - name: ðŸš€ éƒ¨ç½²å‰ç«¯é™æ€æ–‡ä»¶
#        uses: appleboy/scp-action@v0.1.7
#        with:
#          host: ${{ secrets.SERVER_HOST }}
#          username: ${{ secrets.SERVER_USER }}
#          key: ${{ secrets.SSH_PRIVATE_KEY }}
#          source: "dist/*"
#          target: "/var/www/skillspace/frontend"
#      
#      # éƒ¨ç½²åŽç«¯åˆ°æœåŠ¡å™¨
#      - name: ðŸš€ éƒ¨ç½²DjangoåŽç«¯
#        uses: appleboy/ssh-action@v1.0.3
#        with:
#          host: ${{ secrets.SERVER_HOST }}
#          username: ${{ secrets.SERVER_USER }}
#          key: ${{ secrets.SSH_PRIVATE_KEY }}
#          script: |
#            cd /var/www/skillspace/backend
#            git pull origin main
#            source venv/bin/activate
#            pip install -r requirements.txt
#            python manage.py migrate --noinput
#            python manage.py collectstatic --noinput
#            sudo systemctl restart gunicorn
#            sudo systemctl restart nginx
#            sudo systemctl restart celery
#      
#      # éƒ¨ç½²æˆåŠŸé€šçŸ¥
#      - name: âœ… éƒ¨ç½²æˆåŠŸ
#        run: |
#          echo "ðŸŽ‰ SkillSpace å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒï¼"
# 
# ========================================
# äº”ã€Dockerå®¹å™¨åŒ–éƒ¨ç½²ç¤ºä¾‹
# ========================================
# 
#  deploy-docker:
#    name: ðŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²
#    runs-on: ubuntu-latest
#    needs: build-success
#    
#    steps:
#      - name: ðŸ“¥ æ£€å‡ºä»£ç 
#        uses: actions/checkout@v4
#      
#      # ç™»å½•Docker Hub
#      - name: ðŸ”‘ ç™»å½• Docker Hub
#        uses: docker/login-action@v3
#        with:
#          username: ${{ secrets.DOCKER_USERNAME }}
#          password: ${{ secrets.DOCKER_PASSWORD }}
#      
#      # æž„å»ºå¹¶æŽ¨é€åŽç«¯é•œåƒ
#      - name: ðŸ› ï¸ æž„å»ºåŽç«¯ Docker é•œåƒ
#        uses: docker/build-push-action@v5
#        with:
#          context: ./backend
#          push: true
#          tags: |
#            yourusername/skillspace-backend:latest
#            yourusername/skillspace-backend:${{ github.sha }}
#      
#      # æž„å»ºå¹¶æŽ¨é€å‰ç«¯é•œåƒ
#      - name: ðŸ› ï¸ æž„å»ºå‰ç«¯ Docker é•œåƒ
#        uses: docker/build-push-action@v5
#        with:
#          context: ./frontend/skillspace
#          push: true
#          tags: |
#            yourusername/skillspace-frontend:latest
#            yourusername/skillspace-frontend:${{ github.sha }}
#      
#      # éƒ¨ç½²åˆ°æœåŠ¡å™¨
#      - name: ðŸš€ éƒ¨ç½²Docker Compose
#        uses: appleboy/ssh-action@v1.0.3
#        with:
#          host: ${{ secrets.SERVER_HOST }}
#          username: ${{ secrets.SERVER_USER }}
#          key: ${{ secrets.SSH_PRIVATE_KEY }}
#          script: |
#            cd /opt/skillspace
#            docker compose pull
#            docker compose up -d --remove-orphans
#            docker compose exec backend python manage.py migrate --noinput
# 
# ========================================
# å…­ã€ç›‘æŽ§å’Œå‘Šè­¦å»ºè®®
# ========================================
# 
# 1. åº”ç”¨æ€§èƒ½ç›‘æŽ§ï¼š
#    - Sentryï¼šé”™è¯¯è¿½è¸ªå’Œæ€§èƒ½ç›‘æŽ§
#    - New Relic / DataDogï¼šAPMç›‘æŽ§
#    - Prometheus + Grafanaï¼šè‡ªå»ºç›‘æŽ§
# 
# 2. æ—¥å¿—èšåˆï¼š
#    - ELK Stack (Elasticsearch + Logstash + Kibana)
#    - Loki + Grafana
#    - é˜¿é‡Œäº‘SLS / è…¾è®¯äº‘CLS
# 
# 3. å‘Šè­¦é€šçŸ¥ï¼š
#    - é‚®ä»¶é€šçŸ¥
#    - ä¼ä¸šå¾®ä¿¡/é’‰é’‰æœºå™¨äºº
#    - Slack/Discord Webhook
# 
# ========================================
# ä¸ƒã€å®‰å…¨æœ€ä½³å®žè·µ
# ========================================
# 
# 1. HTTPS/SSLè¯ä¹¦ï¼š
#    - ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
#    - Certbot è‡ªåŠ¨ç»­æœŸ
# 
# 2. é˜²ç«å¢™é…ç½®ï¼š
#    - ä»…å¼€æ”¾å¿…è¦ç«¯å£ï¼š80, 443, 22(é™åˆ¶IP)
#    - ä½¿ç”¨ UFW/iptables
# 
# 3. æ•°æ®åº“å®‰å…¨ï¼š
#    - ç¦æ­¢rootè¿œç¨‹ç™»å½•
#    - å®šæœŸå¤‡ä»½
#    - å¯ç”¨SSLè¿žæŽ¥
# 
# 4. Djangoå®‰å…¨é…ç½®ï¼š
#    - DEBUG=False
#    - ALLOWED_HOSTS é™åˆ¶
#    - SECURE_SSL_REDIRECT=True
#    - SESSION_COOKIE_SECURE=True
#    - CSRF_COOKIE_SECURE=True
# 
# ========================================
