name: CIä»£ç æ£€æŸ¥

on:
  push:
    branches: [ "main", "master", "dev" ]
  pull_request:
    branches: [ "main", "master" ]

# å¢åŠ å®‰å…¨æƒé™å£°æ˜
permissions:
  contents: read

jobs:
  lint:
    name: ä»£ç è§„èŒƒæ£€æŸ¥
    runs-on: ubuntu-latest
    
    steps:
    # 1. æ£€å‡ºä»£ç 
    - name: ğŸ™ æ£€å‡ºä»“åº“ä»£ç 
      uses: actions/checkout@v4

    # 2. é…ç½® Python
    - name: âš™ï¸ é…ç½® Python ç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    # 3. é‡ç‚¹ä¼˜åŒ–ï¼šç¼“å­˜ pre-commit çš„é’©å­ç¯å¢ƒ
    - name: ğŸ’¾ ç¼“å­˜ pre-commit ä¾èµ–
      uses: actions/cache@v4
      with:
        path: ~/.cache/pre-commit
        key: ${{ runner.os }}-pre-commit-${{ hashFiles('.pre-commit-config.yaml') }}
        restore-keys: |
          ${{ runner.os }}-pre-commit-

    # 4. å®‰è£…å·¥å…·
    - name: ğŸ“¦ å®‰è£…æ£€æŸ¥å·¥å…·
      run: |
        python -m pip install --upgrade pip
        pip install pre-commit

    # 5. è¿è¡Œæ£€æŸ¥
    - name: ğŸ” è¿è¡Œä»£ç æ£€æŸ¥
      run: |
        # å³ä½¿æ²¡æœ‰ä¿®æ”¹çš„æ–‡ä»¶ä¹Ÿè¿è¡Œæ£€æŸ¥ï¼ˆ--all-filesï¼‰
        # å¦‚æœåªæƒ³æ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå¯ä»¥å»æ‰ --all-files
        if pre-commit run --all-files; then
          echo "âœ… ä»£ç æ£€æŸ¥é€šè¿‡ï¼âœ¨ ä¼˜é›…å¦‚ä½ ï¼Œæäº¤æ— å‹åŠ›~"
        else
          echo "âš ï¸ ä»£ç æ£€æŸ¥å¤±è´¥ï¼ğŸš¨ è¯·ä¿®å¤åé‡è¯•ï¼ˆæŸ¥çœ‹ä¸Šæ–¹æ—¥å¿—å®šä½é—®é¢˜ï¼‰"
          exit 1
        fi